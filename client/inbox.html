<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inbox - Plano</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <header>
        <a href="index.html" class="header-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"></path><polyline points="12 19 5 12 12 5"></polyline></svg>
            <h1>PLANO</h1>
        </a>
    </header>

    <main class="inbox-container">
        <div class="inbox-header">
            <h2>Caixa de Entrada</h2>
            <div class="botoes-acao-inbox">
                <button id="btn-importar-extrato" class="btn-acao-header btn-importar">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"></path><polyline points="7 9 12 4 17 9"></polyline><line x1="12" y1="4" x2="12" y2="16"></line></svg>
                    Importar
                </button>
                <button id="btn-abrir-filtros" class="btn-acao-header">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z"></path></svg>
                    Filtros
                </button>
                <button id="btn-abrir-massa" class="btn-acao-header btn-processar">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
                    Processar em massa
                </button>
            </div>
        </div>
        
        <div class="search-bar-container">
            <input type="text" id="filtro-descricao-rapido" class="search-input" placeholder="Buscar por descrição...">
        </div>

        <table class="inbox-table">
            <thead>
                <tr>
                    <th><input type="checkbox" id="checkbox-select-all"></th>
                    <th>Data</th>
                    <th>Descrição</th>
                    <th>Valor</th>
                    <th>Categoria</th>
                    <th>Perfil</th>
                    <th>Status</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="inbox-table-body">
                <tr>
                    <td colspan="8" style="text-align: center;">Carregando...</td>
                </tr>
            </tbody>
        </table>
    </main>
    
    <div id="modal-filtros-backdrop" class="modal-backdrop hidden">
        <div class="modal" style="max-width: 450px;">
            <form id="form-filtros">
                <h2>Filtros e busca</h2>
                <div class="form-group">
                    <label for="filtro-descricao">Descrição contém</label>
                    <input type="text" id="filtro-descricao" placeholder="Ex: Uber, Almoço...">
                </div>
                <div class="filtro-grid">
                    <div class="form-group"><label for="filtro-data-de">Período De</label><input type="date" id="filtro-data-de"></div>
                    <div class="form-group"><label for="filtro-data-ate">Período Até</label><input type="date" id="filtro-data-ate"></div>
                </div>
                <div class="filtro-grid">
                    <div class="form-group"><label for="filtro-valor-min">Valor Mínimo</label><input type="number" id="filtro-valor-min" step="0.01" placeholder="0,00"></div>
                    <div class="form-group"><label for="filtro-valor-max">Valor Máximo</label><input type="number" id="filtro-valor-max" step="0.01" placeholder="10.000,00"></div>
                </div>
                <div class="form-group">
                    <label>Filtros Rápidos</label>
                    <div class="filtro-rapido">
                        <input type="checkbox" id="filtro-sem-categoria"> <label for="filtro-sem-categoria">Sem categoria</label>
                    </div>
                    <div class="filtro-rapido">
                        <input type="checkbox" id="filtro-sem-perfil"> <label for="filtro-sem-perfil">Sem perfil</label>
                    </div>
                    <div class="filtro-rapido radio-group">
                        <input type="radio" id="filtro-status-todos" name="filtro_status" value="" checked> <label for="filtro-status-todos">Todos</label>
                        <input type="radio" id="filtro-status-pendente" name="filtro_status" value="PENDENTE"> <label for="filtro-status-pendente">Pendente</label>
                        <input type="radio" id="filtro-status-processado" name="filtro_status" value="PROCESSADO"> <label for="filtro-status-processado">Processado</label>
                    </div>
                </div>
                <div class="form-group"><label for="filtro-categoria">Filtrar por Categoria</label><select id="filtro-categoria"><option value="">Todas</option></select></div>
                <div class="form-group"><label for="filtro-perfil">Filtrar por Perfil</label><select id="filtro-perfil"><option value="">Todos</option></select></div>
                <div class="modal-botoes">
                    <button type="button" id="btn-limpar-filtros" class="btn-secondary">Limpar Filtros</button>
                    <button type="submit" class="btn-primary">Aplicar</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="modal-massa-backdrop" class="modal-backdrop hidden">
        <div class="modal" style="max-width: 400px;">
            <form id="form-aplicar-massa">
                <h2>Processar em massa</h2>
                <p id="contador-selecionados">0 transações selecionadas.</p>
                <div class="form-group"><label for="massa-categoria">Categoria *</label><select id="massa-categoria" required></select></div>
                <div class="form-group"><label for="massa-perfil">Perfil *</label><select id="massa-perfil" required></select></div>
                <div class="modal-botoes">
                    <button type="button" id="btn-cancelar-massa" class="btn-secondary">Cancelar</button>
                    <button type="submit" class="btn-primary">Aplicar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-edit-backdrop" class="modal-backdrop hidden">
        <div class="modal" style="max-width: 450px;">
            <form id="form-edit-transacao" enctype="multipart/form-data">
                <h2>Editar Transação</h2>
                <p>Valor, Data e Tipo não podem ser alterados.</p>
                
                <input type="hidden" id="edit-transacao-id">

                <div class="form-group">
                    <label for="edit-descricao">Descrição</label>
                    <input type="text" id="edit-descricao" placeholder="Ex: Almoço no restaurante">
                </div>
                <div class="form-group">
                    <label for="edit-categoria">Categoria</label>
                    <select id="edit-categoria"></select>
                </div>
                <div class="form-group">
                    <label for="edit-perfil">Perfil</label>
                    <select id="edit-perfil"></select>
                </div>
                
                <div class="form-group">
                    <label>Anexar recibo</label>
                    <input type="file" id="edit-anexo" name="anexo">
                </div>

                <div class="modal-botoes">
                    <button type="button" id="btn-cancelar-edit" class="btn-secondary">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="modal-anexo-viewer" class="modal-backdrop hidden">
        <div class="modal" style="max-width: 80vw; max-height: 80vh;">
            <img id="anexo-image-viewer" src="" alt="Recibo" style="width: 100%; height: 100%; object-fit: contain;">
            <div class="modal-botoes">
                 <button type="button" id="btn-fechar-anexo-viewer" class="btn-secondary">Fechar</button>
            </div>
        </div>
    </div>

    <div id="modal-importacao-extrato" class="modal-backdrop hidden">
        <div class="modal" style="max-width: 520px;">
            <form id="form-importacao-extrato" enctype="multipart/form-data">
                <h2>Importar extrato bancário</h2>
                <p>Importe arquivos .csv ou .ofx. Todas as transações irão para a Inbox para categorização.</p>

                <div class="form-group">
                    <label for="import-arquivo">Arquivo</label>
                    <input type="file" id="import-arquivo" name="arquivo" accept=".csv,.ofx" required>
                </div>

                <div class="form-group">
                    <label for="select-mapeamento">Mapeamento salvo</label>
                    <select id="select-mapeamento">
                        <option value="">Selecionar mapeamento...</option>
                    </select>
                </div>

                <div id="mapping-preview" class="mapping-preview hidden">
                    <div class="mapping-header">
                        <h3>Mapeamento CSV</h3>
                        <p>Passo 2 de 2 • Configure as colunas do arquivo CSV</p>
                    </div>
                    <div class="mapping-instructions">
                        <strong>Como mapear</strong>
                        <p>Selecione o tipo de cada coluna. <span>Data, Valor e Descrição são obrigatórios.</span> Colunas desnecessárias podem ser marcadas como "Ignorar".</p>
                    </div>
                    <div class="mapping-table-wrapper">
                        <table id="mapping-preview-table" class="mapping-table">
                            <thead></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div id="mapping-alert" class="mapping-alert hidden"></div>
                </div>

                <div class="form-group">
                    <label class="checkbox-inline">
                        <input type="checkbox" id="checkbox-salvar-mapeamento"> Salvar mapeamento para futuras importações
                    </label>
                    <input type="text" id="input-nome-mapeamento" class="hidden" placeholder="Nome do mapeamento (ex: Banco XPTO)">
                </div>

                <div class="modal-botoes">
                    <button type="button" id="btn-cancelar-import" class="btn-secondary">Cancelar</button>
                    <button type="submit" class="btn-primary">Importar</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module" src="js/inbox.js"></script>
</body>
</html>
